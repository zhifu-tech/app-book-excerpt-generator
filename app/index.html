<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <meta name="theme-color" content="#2563eb" />
    <title>随心书摘生成器</title>
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%232563eb' d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z'/%3E%3Cpath fill='%232563eb' d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z'/%3E%3C/svg%3E"
    />
    <link
      rel="alternate icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%232563eb' d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z'/%3E%3Cpath fill='%232563eb' d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z'/%3E%3C/svg%3E"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.font.im/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@300;400;700&family=Noto+Serif+TC:wght@300;400;700&family=Zhi+Mang+Xing&family=Long+Cang&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- 尝试使用更新的版本以获得更好的文字渲染质量 -->
  </head>
  <body>
    <div class="app-container">
      <!-- Right Sidebar: Controls - 颠覆性设计：右侧浮动面板 -->
      <aside class="sidebar" id="sidebar">
        <!-- 可拖动的分隔条 -->
        <div class="sidebar-resizer" id="sidebar-resizer"></div>
        <div class="sidebar-header">
          <div class="logo">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            <span>随心书斋</span>
          </div>
        </div>

        <div class="controls-scroll">
          <div class="control-group">
            <label>摘录内容</label>
            <div class="editor-group">
              <div class="editor-tabs">
                <div class="tab-triggers">
                  <button type="button" class="tab-btn active" data-tab="write">编辑</button>
                  <button type="button" class="tab-btn" data-tab="preview">预览</button>
                </div>
                <div class="text-tools">
                  <button type="button" class="tool-btn" data-command="bold" title="加粗">
                    <b>B</b>
                  </button>
                  <button type="button" class="tool-btn" data-command="italic" title="斜体">
                    <i>I</i>
                  </button>
                  <button type="button" class="tool-btn" data-command="subscript" title="下标">
                    X<sub>2</sub>
                  </button>
                  <button type="button" class="tool-btn" data-command="superscript" title="上标">
                    X<sup>2</sup>
                  </button>
                  <div class="tool-divider"></div>
                  <button type="button" class="tool-btn" data-align="left" title="左对齐">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M17 10H3M21 6H3M21 14H3M17 18H3" />
                    </svg>
                  </button>
                  <button type="button" class="tool-btn" data-align="center" title="居中对齐">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M18 10H6M21 6H3M21 14H3M18 18H6" />
                    </svg>
                  </button>
                  <button type="button" class="tool-btn" data-align="right" title="右对齐">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M21 10H7M21 6H3M21 14H3M21 18H7" />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="editor-content">
                <textarea
                  id="quote-text"
                  name="quote-text"
                  placeholder="在这里输入你喜欢的文字..."
                  rows="5"
                  aria-label="摘录内容输入框"
                >
生活不可能像你想象得那么好，但也不会像你想象得那么糟。</textarea
                >
                <div id="quote-preview" class="quote-preview hidden"></div>
              </div>
            </div>
          </div>

          <div class="control-row">
            <div class="control-group half">
              <label for="book-title">书名/出处</label>
              <textarea id="book-title" name="book-title" rows="2" aria-label="书名或出处">
羊脂球</textarea
              >
            </div>
            <div class="control-group half">
              <label for="author-text">作者</label>
              <input
                type="text"
                id="author-text"
                name="author-text"
                value="莫泊桑"
                aria-label="作者姓名"
              />
            </div>
          </div>

          <div class="control-row">
            <div class="control-group half">
              <label for="seal-text">印章落款 (最多4字)</label>
              <input
                type="text"
                id="seal-text"
                name="seal-text"
                value="随心书斋"
                maxlength="4"
                aria-label="印章落款，最多4个字"
              />
            </div>
            <div class="control-group half">
              <label for="seal-font">印章字体</label>
              <select id="seal-font" name="seal-font" class="style-select">
                <option value="'Ma Shan Zheng', cursive">马善政 (毛笔)</option>
                <option value="'Noto Serif TC', serif">思源宋体 (繁体)</option>
                <option value="'Noto Serif SC', serif">思源宋体 (简体)</option>
                <option value="'Zhi Mang Xing', cursive">志莽行书</option>
                <option value="'Long Cang', cursive">龙苍行书</option>
              </select>
            </div>
          </div>

          <!-- 卡片组 -->
          <div class="control-section">
            <div class="section-header">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
              <span>卡片</span>
            </div>
            <div class="section-content">
              <div class="control-group">
                <div class="layout-select-group" role="radiogroup" aria-label="文字排列方式">
                  <label class="layout-option">
                    <input
                      type="radio"
                      name="layout"
                      value="horizontal"
                      checked
                      aria-label="横排模式"
                    />
                    <span class="layout-option-icon">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M4 6h16M4 12h16M4 18h16"></path>
                      </svg>
                    </span>
                  </label>
                  <label class="layout-option">
                    <input
                      type="radio"
                      name="layout"
                      value="vertical"
                      aria-label="竖排模式（古风）"
                    />
                    <span class="layout-option-icon">
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M6 4v16M12 4v16M18 4v16"></path>
                      </svg>
                    </span>
                  </label>
                </div>
              </div>

              <div class="control-group">
                <div class="control-label">背景</div>
                <div class="theme-grid" id="theme-grid" role="group" aria-label="主题选择">
                  <!-- Themes will be injected by JS -->
                </div>
              </div>

              <div class="control-group">
                <div class="control-label">
                  <span>卡片宽度</span>
                  <span class="width-value" id="card-width-value">400px</span>
                </div>
                <div class="width-hint">
                  视觉宽度，如苹果 12 Pro 手机，视觉宽度是 390px，密度是 3，导出图片的大小是 1170px
                  = 390 × 3
                </div>
                <div class="width-slider-container">
                  <input
                    type="range"
                    id="card-width-slider"
                    min="300"
                    max="600"
                    step="30"
                    value="400"
                    aria-label="卡片宽度"
                  />
                  <div class="slider-labels">
                    <span>300px</span>
                    <span>600px</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 字体组 -->
          <div class="control-section">
            <div class="section-header">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M4 7V4h16v3"></path>
                <path d="M5 20h6"></path>
                <path d="M13 20h7"></path>
                <path d="M5 16h6"></path>
                <path d="M13 16h7"></path>
                <path d="M5 12h6"></path>
                <path d="M13 12h7"></path>
                <path d="M5 8h6"></path>
                <path d="M13 8h7"></path>
              </svg>
              <span>字体</span>
            </div>
            <div class="section-content">
              <div class="control-group">
                <div class="font-grid" id="font-grid" role="group" aria-label="字体选择">
                  <!-- Fonts will be injected by JS -->
                </div>
              </div>

              <div class="control-group">
                <div class="control-label">颜色</div>
                <div class="color-grid" id="font-color-grid" role="group" aria-label="字体颜色选择">
                  <!-- Font colors will be injected by JS -->
                </div>
              </div>

              <div class="control-group">
                <div class="control-label">
                  <span>字号</span>
                  <span class="width-value" id="font-size-value">18px</span>
                </div>
                <div class="width-slider-container">
                  <input
                    type="range"
                    id="font-size-slider"
                    min="14"
                    max="32"
                    step="2"
                    value="18"
                    aria-label="字号"
                  />
                  <div class="slider-labels">
                    <span>14px</span>
                    <span>32px</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 导出选项组 -->
          <div class="control-section">
            <div class="section-header">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              <span>导出选项</span>
            </div>
            <div class="section-content">
              <div class="control-group">
                <div class="export-format-grid" role="group" aria-label="导出格式选择">
                  <label class="export-format-option">
                    <input
                      type="checkbox"
                      name="export-format"
                      value="png"
                      checked
                      aria-label="PNG 格式"
                    />
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="9" y1="3" x2="9" y2="21"></line>
                    </svg>
                    <span>PNG</span>
                  </label>
                  <label class="export-format-option">
                    <input
                      type="checkbox"
                      name="export-format"
                      value="jpeg"
                      aria-label="JPEG 格式"
                    />
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <circle cx="8.5" cy="8.5" r="1.5"></circle>
                      <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    <span>JPEG</span>
                  </label>
                  <label class="export-format-option">
                    <input type="checkbox" name="export-format" value="svg" aria-label="SVG 格式" />
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                      ></path>
                      <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                      <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    <span>SVG</span>
                  </label>
                  <label class="export-format-option">
                    <input
                      type="checkbox"
                      name="export-format"
                      value="webp"
                      aria-label="WebP 格式"
                    />
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <circle cx="8.5" cy="8.5" r="1.5"></circle>
                      <path d="M21 15l-5-5L5 21"></path>
                    </svg>
                    <span>WebP</span>
                  </label>
                </div>
              </div>
              <div class="control-group">
                <div class="control-label">配置管理</div>
                <div
                  class="config-actions"
                  style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px"
                >
                  <button
                    type="button"
                    class="secondary-btn export-config-btn"
                    id="export-config-btn"
                    style="
                      width: 100%;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      gap: 8px;
                      padding: 10px;
                      background: var(--bg-secondary);
                      border: 1px solid var(--border-color);
                      border-radius: var(--radius-md);
                      cursor: pointer;
                      font-size: 14px;
                      transition: all 0.2s;
                    "
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    导出配置
                  </button>
                  <button
                    type="button"
                    class="secondary-btn import-btn"
                    id="import-config-btn"
                    style="
                      width: 100%;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      gap: 8px;
                      padding: 10px;
                      background: var(--bg-secondary);
                      border: 1px solid var(--border-color);
                      border-radius: var(--radius-md);
                      cursor: pointer;
                      font-size: 14px;
                      transition: all 0.2s;
                    "
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    导入配置
                  </button>
                </div>
                <input type="file" id="config-file-input" accept=".json" style="display: none" />
              </div>
            </div>
          </div>
        </div>

        <div class="sidebar-footer">
          <button
            class="primary-btn save-btn"
            id="download-btn"
            type="button"
            aria-label="保存并下载书摘卡片"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            保存
          </button>
        </div>
      </aside>

      <!-- Right Panel: Preview -->
      <main
        class="preview-area"
        id="preview-area"
        role="button"
        tabindex="0"
        aria-label="预览卡片"
        aria-expanded="false"
      >
        <div id="card-preview" class="card theme-clean">
          <div class="card-header">
            <span class="date" id="current-date">2025.11.24</span>
            <span class="tag">读书偶得</span>
          </div>

          <div class="card-body">
            <div class="quote-mark start">"</div>
            <div class="text-content" id="preview-text">
              生活不可能像你想象得那么好，但也不会像你想象得那么糟。
            </div>
            <div class="quote-mark end">"</div>
          </div>

          <div class="card-footer-info">
            <div class="book-info">
              <div class="line"></div>
              <div class="meta">
                <span class="book" id="preview-book">羊脂球</span>
                <span class="author" id="preview-author">莫泊桑</span>
              </div>
            </div>
            <div class="seal-box">
              <div class="seal" id="preview-seal">志福随笔</div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Floating Action Buttons - 桌面端和移动端共用 -->
    <div class="floating-actions">
      <!-- 保存按钮 -->
      <button
        class="fab save-fab"
        id="download-fab"
        type="button"
        aria-label="保存并下载"
        title="保存"
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </button>
    </div>

    <script type="module" src="js/index.js"></script>
  </body>
</html>
